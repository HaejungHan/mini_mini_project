<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>collector</title>
    <!-- icon awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Gowun+Dodum&family=Hahmlet:wght@100..900&display=swap');

        * {
            font-family: "Gowun Dodum", serif;
        }

        .title {
            height: 250px;
            background-color: rgb(0, 37, 73);
            color: white;

            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /*  left section */
        #box1 {
            float: left;
            width: 200%;
            background-color: #f1f1f5;
            color: rgb(10, 10, 10);
        }

        /*  right section */
        #box2 {
            display: inline-block;
            width: 50%;
            background-color: #a09f9f;
            margin-left: 10px;
            color: rgb(8, 8, 8);
            font-size: 20px;
        }


        /* 새로운 취미명 입력 + 링크추가 입력 modal창 */
        .modal-content {
            width: 500px;
            margin: 0 auto 20px auto;

            /* border: 3px solid rgb(116, 15, 15); */
            background-color: rgb(195, 240, 255);
            padding: 20px;
            border-radius: 5px;

        }

        /* category table */
        .table>button {
            width: 218px;
            margin-top: 5px;

            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;

        }
    </style>

    <script type="module">
        // Firebase SDK 라이브러리 가져오기
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, doc, setDoc, getDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        import { collection, addDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        import { getDocs } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";


        // Firebase 구성 정보 설정
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyDfoGCUcSyKm0zm-UTsw5C9327kyvJalT8",
            authDomain: "sparta-d2304.firebaseapp.com",
            projectId: "sparta-d2304",
            storageBucket: "sparta-d2304.appspot.com",
            messagingSenderId: "847019838879",
            appId: "1:847019838879:web:8c5ae3752d4f56fd3681aa",
            measurementId: "G-BP1253G888"
        };


        // Firebase 인스턴스 초기화
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);



        // 새 취미 저장버튼 클릭 시
        $("#saveHobby").click(async function () {
            // 입력된 취미명을 가져옵니다.
            let inputHobby = $('#inputHobby').val();

            // await addDoc(collection(db, "hobbies"), { hobbyName: inputHobby });
            const docRef = doc(db, "hobbies", inputHobby); // "hobbies" 컬렉션에 대한 참조 생성
            await setDoc(docRef, { hobbyName: inputHobby }); // 새로운 문서 추가
            alert('저장 완료!');
            window.location.reload();
        });



        // 링크 저장 버튼 클릭 시
        $("#saveLink").click(async function () {
            // 선택된 취미명을 가져옵니다.
            let selectHobby = $('#selectHobby').val();
            let contentType = $('#contentType').val();
            let address = $('#address').val();

            try {
                // 선택한 취미가 이미 존재하는 경우 해당 문서를 업데이트합니다.
                const docRef = doc(db, "hobbies", selectHobby); // 문서를 직접 참조
                // await setDoc(docRef, { contentType: contentType, address: address }, { merge: true });
                // await setDoc(docRef, {
                //     contents: firestore.FieldValue.arrayUnion({
                //         contentType: contentType,
                //         address: address
                //     })
                // }, { merge: true });
                await setDoc(docRef, {
                    contents: arrayUnion({
                        contentType: contentType,
                        address: address
                    })
                }, { merge: true });
                alert('저장 완료!');
                window.location.reload();
            } catch (error) {
                console.error("Error updating document: ", error);
                alert('저장에 실패했습니다.');
            }
        });


        let docs = await getDocs(collection(db, "hobbies"));
        docs.forEach((doc) => {
            let row = doc.data();

            let inputHobby = row['hobbyName'];


            //취미명 버튼 추가
            let temp_html1 = `
            <button id="${inputHobby}" type="button" class="btn btn-secondary">${inputHobby}</button>`;
            $('#category').append(temp_html1);


            //링크 저장 버튼 내에 취미 선택지 추가
            let temp_html2 = `
            <option value="${inputHobby}">${inputHobby}</option>`;
            $('#selectHobby').append(temp_html2);

        });



        //!!!준빈님이 완성하실 부분!!! 취미버튼 클릭 시 - 클릭 이벤트 핸들러 정의 (버튼이 생성된 이후에 정의되어야 함)
        $(document).on("click", ".btn-secondary", async function () {
            // 클릭된 버튼에 대한 동작 구현

            // 예를 들어, 클릭된 취미에 대한 추가 정보를 가져오는 등의 작업을 수행할 수 있습니다.
            let hobbyName = $(this).attr("id");
            console.log("Clicked hobby: ", hobbyName);


            //기록타입과 링크주소 각각의 배열 (n번째 요소끼리 세트)
            let contentTypes = [];
            let addresses = [];


            const docRef = doc(db, "hobbies", hobbyName);
            const docSnap = await getDoc(docRef);

            const data = docSnap.data();

            data.contents.forEach((content) => {
                contentTypes.push(content.contentType);
                addresses.push(content.address);
            });

            // 배열에 저장된 contentType과 address를 출력하거나 사용할 수 있습니다.
            console.log("Content Types:", contentTypes);
            console.log("Addresses:", addresses);



            // 여기에 추가 작업을 수행하세요.
        });

    </script>
</head>

<body>
    <!-- header -->
    <header
        class="d-flex flex-wrap align-items-center justify-content-center justify-content-md-between py-3 mb-4 border-bottom">
        <div class="col-md-3 mb-2 mb-md-0">
            <a href="/" class="d-inline-flex link-body-emphasis text-decoration-none">
                <svg class="bi" width="40" height="32" role="img" aria-label="Bootstrap">
                    <use xlink:href="#bootstrap"></use>
                </svg>
            </a>
        </div>

        <ul class="nav col-12 col-md-auto mb-2 justify-content-center mb-md-0">
            <li><a href="#" class="nav-link px-2 link-secondary">Collector</a></li>
        </ul>

        <button type="button" class="btn btn-primary">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20 " fill="currentColor" class="bi bi-gear"
                viewBox="0 0 16 16">
                <path
                    d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492M5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0">
                </path>
                <path
                    d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115z">
                </path>
            </svg>
        </button>

    </header>

    <div class="title">
        <h1>Collector</h1>
    </div>

    <div class="main">
        <div class="d-md-flex flex-md-equal w-100 my-md-3 ps-md-3">
            <!-- left section -->
            <div id="box1" class="text-bg-dark me-md-3 pt-3 px-3 pt-md-5 px-md-5 text-center overflow-hidden">
                <div class="my-3 py-3">
                    <h2 class="display-5">
                        <form class="w-100 me-3" role="search">
                            <input type="search" class="form-control" placeholder="Search..." aria-label="Search">
                        </form>
                    </h2>
                    <p class="lead">취미명</p>
                    <ul>
                        <li>Youtube</li>
                        <li>나무위키</li>
                        <li>사진</li>
                    </ul>
                </div>
            </div>
            <!-- right section -->
            <div id="box2" class="bg-body-tertiary me-md-3 pt-3 px-3 pt-md-5 px-md-5 text-center overflow-hidden">
                <div class="my-3 p-3">
                    <!-- 새로운 취미입력 btn-->
                    <button type="button" class="btn btn-outline-dark" data-bs-toggle="modal"
                        data-bs-target="#hobbyModal">
                        새 취미 입력
                    </button>
                    <!-- 새로운 취미입력 Modal창 -->
                    <div class="modal fade" id="hobbyModal" tabindex="-1" aria-labelledby="exampleModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <!-- <h1 class="modal-title fs-5" id="exampleModalLabel">Modal title</h1> -->
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <div class="form-floating mb-3">
                                        <input type="email" class="form-control" id="inputHobby" placeholder="취미명">
                                        <label for="floatingInput">새로운 취미명 입력</label>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <!-- <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                        <button type="button" class="btn btn-primary">Save changes</button> -->
                                    <button id="saveHobby" type="button" class="btn btn-danger">저장하기</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 링크추가 btn -->
                    <button type="button" class="btn btn-outline-dark" data-bs-toggle="modal"
                        data-bs-target="#contentModal">
                        링크 추가
                    </button>
                    <!-- 링크추가 Modal창 -->
                    <div class="modal fade" id="contentModal" tabindex="-1" aria-labelledby="exampleModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">

                                <div class="modal-header">
                                    <!-- <h1 class="modal-title fs-5" id="exampleModalLabel">Modal title</h1> -->
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                                </div>


                                <div class="modal-body">
                                    <div class="form-floating mb-3">
                                        <select class="form-select" id="selectHobby"
                                            aria-label="Floating label select example">
                                            <option selected>-- 선택 --</option>
                                            <!-- <option value="photo">사진</option>
                                                <option value="youtube">유튜브 영상</option>
                                                <option value="namu">나무위키</option> -->
                                        </select>
                                        <label for="floatingSelect">취미</label>
                                    </div>

                                    <div class="form-floating mb-3">
                                        <select class="form-select" id="contentType"
                                            aria-label="Floating label select example">
                                            <option selected>-- 선택 --</option>
                                            <option value="photo">사진</option>
                                            <option value="youtube">유튜브 영상</option>
                                            <option value="namu">나무위키</option>
                                        </select>
                                        <label for="floatingSelect">기록타입</label>
                                    </div>

                                    <div class="form-floating mb-3">
                                        <input type="email" class="form-control" id="address" placeholder="링크">
                                        <label for="floatingInput">링크 주소 입력</label>
                                    </div>
                                </div>


                                <div class="modal-footer">
                                    <!-- <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                        <button type="button" class="btn btn-primary">Save changes</button> -->
                                    <button id="saveLink" type="button" class="btn btn-danger">저장하기</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <p><br />취미 목록<br /></p>

                    <!-- category -->
                    <div id="category" class="table">
                    </div>

                </div>
            </div>
        </div>
    </div>
</body>

</html>